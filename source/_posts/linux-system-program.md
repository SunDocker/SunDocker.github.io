---
title: Linux系统编程
date: 2022-10-10 11:40:02
tags:
  - linux
  - 计算机
---

## 1 常用工具

### 1.1 gcc

*工作流程概述：*

1. 预处理：**头文件**展开、**宏**替换、去除**注释**

   `gcc -E xxx.c -o xxx.i`

   > `xxx.i`仍然是一个**c文件**
   >
   > 预处理工作本质是由**cpp工具**完成的，gcc命令会调用这个工具

2. 编译：将c文件编译成**汇编文件**

     `gcc -S xxx.i -o xxx.s`

   > 这一步时间往往是**最长**的
   >
   > 编译工作由**gcc工具**完成

3. 汇编：将汇编文件转换成**二进制文件**

   `gcc -c xxx.s -o xxx.o`

   > 汇编工作本质是由**as工具**完成的，gcc命令会调用这个工具

4. 链接：将**函数库**中相应的代码组合到目标文件中

    `gcc xxx.o -o xxx`

   > 将所有相关的`.o`文件打包成一个**可执行文件**，并将`main`函数作为**启动函数**
   >
   > 链接工作本质是由**ld工具**完成的，gcc命令会调用这个工具

   > 可以直接调用链接的命令，这样会自动调用之前的三步：`gcc xxx.c -o xxx`

---

*常用参数：*

- `-I 目录`：指定头文件所在目录
- `-D 宏名`：指定一个宏
- `-O1`、`-O2`、`-O3`：生成汇编之前**优化**代码，`-O`后面数字越大，优化等级越大
- `-Wall`：输出**警告**信息
- `-g`：添加调试信息，之后可以用gdb工具调试

---

*静态库的制作：*

…







### 1.2 gdb





### 1.3 makefile

*一个规则：*



---

*两个函数：*



---

*三个变量：*



---



## 2 系统调用函数

### 2.1 IO



### 2.2 文件目录操作





## 3 进程与线程

### 3.1 进程相关概念

*进程控制块PCB：*

- Linux内核的进程控制块是task_struct结构体

  > `/usr/src/linux-headers-3.16.0-30/include/linux/sched.h`文件中可以查看`struct task_struct`结构体定义



*环境变量：*



### 3.2 进程控制



### 3.3 进程间通信



### 3.4 进程信号

*信号的基本概念：*

- 信号是信息的载体，有如下**特征**：

  - 简单

    > 信号的**开销很小**，就算不使用信号也会有这样的开销

  - 不能携带大量信息

    > 一般来说只能带一个**标志**过去

  - 满足某个**特设条件**才发送

- 信号**机制**：

  - 进程收到信号后，不管执行到程序的什么位置，都要**中断**运行去处理信号，处理完毕再继续执行

    > 采用与**硬件中断**类似的异步模式。但信号是**软件层面**上实现的**中断**，早期常被称为“软中断”

  - **每个进程收到的所有信号，都是由<u>内核负责产生并发送</u>的，<u>内核处理</u>**

- 信号**产生**的五种方式：

  - 终端按键产生
  - 硬件异常产生
  - 命令产生
  - 系统调用产生
  - 软件条件产生

- 信号**状态**：

  - **递达**：递送并且到达进程

    > 内核产生信号后会**立刻发送**给相应进程

  - **阻塞**（屏蔽、未决）：信号产生后受到阻塞，未能递达进程

- 信号的**编号**与**信号集**

  - 信号**编号**

    - 可以使用`kill –l`命令查看当前系统可使用的信号有哪些

    - 1-31号信号称之为**常规信号**（也叫普通信号或标准信号）

    - 34-64称之为实时信号

      > 与嵌入式开发和驱动编程有关

    > `man 7 signal`可以查看相关文档

  - **阻塞信号集(信号屏蔽字)**

    - 将某些信号加入集合，对他们设置屏蔽，收到这些信号时，对其的处理将推迟到解除屏蔽后

  - **未决信号集**

    - 信号产生后未决信号集中**描述该信号的位**立刻翻转为1，表信号处于未决状态，信号被处理后对应位再翻转为0

    - 信号产生后由于某些原因(主要是阻塞)不能抵达，这类信号的集合称之为未决信号集。

      > 在屏蔽解除前，信号一直处于未决状态

- 信号的**三种处理方式**

  - 执行默认动作 
    - Term：终止进程
    - Ign：忽略信号（默认即时对该种信号忽略操作）
    - Core：终止进程并生成**Core文件**（查验进程死亡原因， 用于gdb调试）
    - Stop：暂停进程
    - Cont：继续运行进程
  - 忽略：丢弃
  - 捕捉：调用用户处理函数

  > 值得注意的是 ***9) SIGKILL*** 和 ***19) SIGSTOP*** 信号，不允许忽略和捕捉，只能执行默认动作。甚至不能将其设置为阻塞。

- 信号**四要素**

  - 编号
  - 名称
  - 默认处理动作
  - 事件：使得该信号**产生**的事件

---

*信号的产生：*

- **终端按键**产生信号

  - Ctrl + c → ***2) SIGINT***：终止/中断

    > "INT" ----Interrupt

  - Ctrl + z → ***20) SIGTSTP***：暂停/停止

    > "T" ----Terminal 终端，只能停止与终端交互的进程

  - Ctrl + \ → ***3) SIGQUIT***：退出进程（核心已转储，也是终止进程）

- **硬件异常**产生

  - 浮点数例外：***8) SIGFPE***

    > 例如：除0
    >
    > "F" -----float 浮点数

  - 段错误：***11) SIGSEGV***

    > 例如：非法访问内存

  - 总线错误：***7) SIGBUS***

    > 例如：内存对齐出错

- 命令产生

  - `kill -信号编号 进程ID`：给对应ID的进程发送信号

- 系统调用产生

  - `int kill(pid_t pid, int sig);`

    > `man 2 kill`查看相关文档

  - 

- alarm

- setitimer

---

*信号集：*

- 信号屏蔽字
- 未决信号集

---

*信号的捕捉：*

- 注册信号捕捉函数
- sigaction



### 3.5 进程组与守护进程



### 3.6 线程







