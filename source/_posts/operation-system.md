---
title: 操作系统
abbrlink: cf3a69eb
date: 2022-09-23 10:31:06
tags:
  - 操作系统
  - 计算机
category: 学习资源
---

## 1 操作系统概述

### 1.1 基本概念

- 操作系统（Operating System，OS）是指
  - 控制和管理整个计算机系统的**硬件和软件资源**，并合理地**组织调度计算机的工作**和资源的分配，
  - 以提供给用户和其他软件方便的**接口调用和环境**的系统软件，
  - 它是计算机系统中**最基本的系统软件**。
- 简单来说，
  - 从程序的角度来讲，操作系统就是**对象+API（系统调用）**；
  - 从硬件的角度来讲，操作系统就是一个**C程序代码**



### 1.2 基本特征

- 并发：操作系统会**协调多个程序交替执行**
- 共享：系统**资源**可供多个**并发进程<u>互斥</u>地或<u>同时</u>地使用**
- 虚拟：操作系统将<u>内存、处理器</u>等**物理实体扩展映射为若干个逻辑对应物**
- 异步性：由于**资源有限**，**多进程**并发地**以不可预知的速度推进**



### 1.3 发展与分类

- <u>手工操作阶段</u>时，**人机速度矛盾**突出
- <u>多道批处理阶段</u>中，操作系统诞生，其中引入了**中断**技术，多个**程序并发执行**，资源利用率提高（但不能人机交互）
- <u>分时操作系统</u>**以<u>时间片</u>为单位<u>轮流</u>运行多个程序**，解决了**人机交互**问题（但不能优先响应紧急任务）
- <u>实时操作系统</u>能**优先响应紧急任务**，具有及时性和可靠性



### 1.4 运行机制和体系结构

- 运行机制

  > 两种处理器状态：

  - 核心态
    - 可执行**特权指令、非特权指令**
    - 运行**内核程序**
  - 用户态
    - 只能**非特权指令**
    - 运行**用户程序**

- 操作系统**内核/内核程序**可包含的功能：

  - **时钟**管理

  - **中断**处理

  - **原语**（设备驱动、CPU切换）

  - **资源**管理：进程管理、内存管理、设备管理

    > 根据是否包含**资源管理**相关功能，可分类为**宏内核、微内核**



### 1.5 中断和异常

- 中断的概念/本质

  - 发生中断就意味着**需要操作系统介入**，进入**核心态**，开展管理工作。

    > 中断是使<u>CPU从用户态进入核心态的唯一方式</u>。
    >
    > 本质是修改PSW，核心态下可以直接修改，用户态下只能通过中断修改。

  - 中断由运行在核心态下的**中断处理程序**处理

- 中断的分类

  - 内中断：**异常**
    - 系统调用等**陷入**（trap）
    - 硬件**故障**（fault）
    - 程序**终止**（abort）
  - 外中断：**狭义的中断**
    - 外设请求
    - 人工干预

  > “内外”是相对CPU而言



### 1.6 系统调用

- 系统调用的概念

  - 系统调用是**操作系统提供给应用程序调用的特殊函数**，可以用来获得操作系统的服务，在一情况下保证系统的稳定性和安全性

  > 系统调用需要特权指令，所以会引发陷入类型的**内中断**，从而使CPU从用户态进入**核心态**，执行系统调用相应服务程序。

- 系统调用的功能

  - 进程管理
  - 存储器管理
  - 设备管理

- 库函数

  - 库函数是**对系统调用的封装**
  - 应用程序可以直接使用系统调用，也可以使用封装了系统调用的库函数。



## 2 进程管理

### 2.1 进程概述

- 进程的**概念**
  - 进程是**程序的一次执行过程**，是系统进行**资源调分配**（和调度）的**基本单位**
- 进程的**组成**
  - 程序段
  - 数据段
  - **PCB**
    - 进程**描述**信息：进程标识符（**PID**）、用户标识符（**UID**）
    - 进程**控制和管理**信息：进程当前**状态**、进程当前**优先级**
    - **资源分配**清单：程序段和数据段的指针、键盘鼠标
    - **处理机**相关信息：各种**寄存器**值
- 进程的**组织方式**
  - **链接**方式：按照进程**状态**将PCB组织为多个**队列**
  - **索引**方式：按照进程**状态**将进程组织为多张**索引表**
- 进程的特征
  - 动态性（最基本）：程序的运行过程
  - 独立性：资源分配（和接受调度）的基本单位
  - 并发性
  - 异步性
  - 结构性



### 2.2 进程的状态

- 为了**方便对各个进程的管理**，操作系统将进程合理地划分为几种**状态**

  - 三种基本状态
    - 运行态：占有CPU并**在CPU上运行**
    - 就绪态：**具备运行条件**但不占有CPU，从而不能运行
    - 阻塞态：因等待某一事件而暂时不能运行
  - 两种始末状态
    - 创建态：正在被**创建**并**分配资源**
    - 终止态：正在从系统中**撤销**并**回归资源**
  - 两种内存调度的挂起状态
    - 就绪挂起
    - 阻塞挂起

- 进程的状态转换称为**进程控制**，进程控制用**原语**实现

  > 原语的本质是**关中断**、执行某些操作、**开中断**

  - 创建：分配**资源**，申请并初始化**PCB**（设置为**就绪态**）并将其加入**就绪队列**
  - 撤销：找到对应**PCB**，剥夺**CPU**，**终止进程**（和子进程），归还**资源**，**删除PCB**
  - 阻塞：找到对应**PCB**，**保持运行现场**，**暂停**进程运行，将PCB设置为“**阻塞态**”并插入相应**阻塞队列**
  - 唤醒：在**阻塞队列**中找到对应**PCB**，将PCB从中移除并设置为“**就绪态**”、加入**就绪队列**
  - 切换：将当前进程**运行环境**信息存入PCB，移入相应队列，选择另一个进程，更新其PCB并恢复其运行环境



### 2.3 进程通信

- 进程通信的概念
  - 进程通信就是指**进程之间的信息交换**
  - 进程是分配系统资源的单位（包括内存地址空间），因此各进程拥有的**内存地址空间相互独立**，但进程之间也需要**通信**。
- 进程通信的方法：
  - 共享存储：在内存中划分出一块**共享存储区**，由两个进程**<u>互斥</u>访问**
  - 消息传递：进程间以“**消息(Message)**”这种数据结构为单位，通过操作系统提供的**“发送消息/接收消息”两个原语**进行数据交换
    - 直接通信：消息直接挂到接收进程的**消息缓冲队列**上
    - 间接通信：消息要先发送到**中间实体（信箱）**中，因此也称”信箱通信方式“
- 管道通信：开辟**内存缓冲**区进行**半双工通信**



### 2.4 线程

- 线程的概念与作用

  - 线程是一个**基本的CPU执行单元**，是**CPU调度的基本单位**

    > 进程不再是**CPU调度的基本单位**了，但依然是**操作系统资源分配的基本单位**

  - 线程**提升了系统的并发度**，并发所带来的系统开销减少。

- 线程的属性

  - **CPU调度的基本单位**，有ID、线程控制块（TCB）
  - 三种基本状态和两种始末状态
  - 同一进程的多个线程**共享进程资源**
  - 不同进程的线程切换可以引起进程切换，开销较大；同一进程的线程切换开销较小

- 线程的实现方式

  - 用户级线程：由应用程序通过**线程库**实现，由**应用程序负责管理**，在**<u>用户态</u>**下即可切换，**对操作系统透明**
  - 内核级线程：由**操作系统直接管理**，线程调度、切换需要在**核心态**下完成；只有内核级线程才是**处理机分配的基本单位**。

- 多线程模型

  - 多对一：多个用户级线程映射到一个内核级线程。开销小，效率高，并发度低
  - 一对一：一个用户级线程映射到一个内核级线程。并发能力强，成本高，开销大
  - 多对多模型：n用户及线程映射到m个内核级线程(n>=m)。平衡了**并发度**与**系统开销**



### 2.5 进程调度

#### 2.5.1 处理机调度

- 处理机调度的概念

  - 从进程**队列**中按照一定的算法选择一个进程并将**处理机分配**给它运行

- 处理机调度的层次

  - 作业调度（后备队列）：

    > 只调入和调出一次

    - 调入：从外存后备队列中挑选作业分配资源，并建立相应进程（PCB）
    - 调出：作业运行结束后调出，撤销PCB

  - 内存调度（挂起队列）：

    - 调出：将暂时不能运行的进程调至**外存**，进入挂起状态；PCB仍在内存，记录进程数据位置，加入**挂起队列**
    - 调入：将处于挂起状态并具备运行条件的进程重新调入内存

  - 进程调度（就绪队列）：从**就绪队列**中选取**进程**将处理机分配给它，是最基本的调度，频率很高

- 处理机调度的方式：

  - 进程（调度）切换主要包括对**原进程数据的保存**和**新进程数据的恢复**
  - 需要考虑调度问题的时机：
    - 当前运行的进程**主动放弃**处理机（非抢占式和抢占式）
    - **新的进程进入**就绪队列（抢占式）
  - 不能调度与切换的时机：
    - 处理**中断**
    - **内核程序临界区**
    - **原子操作**



#### 2.5.2 调度算法

- 调度算法评价指标

  - CPU利用率：CPU“**忙碌**”的时间占**总时间**的比例
  - 系统吞吐量：单位时间内完成作业的数量
  - 周转时间：
    - 从**作业被提交给系统**开始，到**作业完成**为止的时间间隔
    - 带权周转时间：**周转时间**除以作业实际**运行时间**
  - 等待时间：进程/作业处于**等待处理机**状态时间之和
  - 响应时间：从用户提交请求到**首次产生响应**所用的时间

- 注重**周转时间**调度算法

  - 先来先服务（FCFS）：按照作业/进程**到达的先后顺序**进行服务（非抢占）

    > **等待时间**最长的优先得到服务

  - 短作业/进程优先（SJF/SPF）：**最短**的作业/进程优先得到服务（抢占、非抢占）

    > 抢占式版本的又称“最短剩余时间优先算法（SRTN）”

  - 高响应比优先（HRRN）：**响应比**最高的作业/进程优先得到服务（非抢占）

    > $响应比=\frac{等待时间}{要求服务时间}+1$

- 注重**响应时间**的调度算法

  > 更适应于交互式系统
  
  - 时间片轮转调度算法（RR）：按照到达顺序**轮流**让**各进程**执行一个时间片，未执行完则重新放到队列尾排队（抢占）
  - 优先级调度算法：选择**优先级最高**的作业/进程（抢占、非抢占）
  - 多级多反馈队列调度算法：（抢占）
    - 设置多级就绪队列，优先级从高到低，时间片从小到大
    - 新进程先进入高优先级队列，用完时间片进入次高优先级队列，若已经是最低优先级则回到队尾
    - 高优先级队列为空时才会给次高优先级分配时间片

